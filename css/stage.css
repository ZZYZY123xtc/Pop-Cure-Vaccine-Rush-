/* ============================================================
   Stage 架构 - 统一参照系
   ============================================================
   
   所有 UI 层共享同一个 #stage 参照系，确保：
   - 所有层完全对齐（position:absolute; inset:0）
   - Canvas 尺寸由 ViewportManager 统一管理
   - 设备旋转/切换不会导致坐标错位
*/

/* Stage 容器：固定在视口，作为所有层的统一参照系 */
#stage {
    position: fixed;
    top: 0;
    left: 0;
    width: 100vw;
    height: 100vh;
    overflow: hidden;
    background: #000;
    /* 禁用所有可能影响坐标的属性 */
    margin: 0;
    padding: 0;
    border: none;
    transform: none;
}

/* 所有层的基础样式：完全填充 stage */
.stage-layer {
    position: absolute;
    inset: 0;  /* 等同于 top:0; right:0; bottom:0; left:0 */
    width: 100%;
    height: 100%;
    margin: 0;
    padding: 0;
    border: none;
}

/* 各个层的额外样式 */

/* 开始屏幕层 */
#start-layer {
    z-index: 1000;
    background: #FFF9F0;
    display: flex;
    justify-content: center;
    align-items: center;
}

#start-layer.hidden {
    display: none;
}

/* 地图层 */
#map-layer {
    z-index: 100;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

#map-layer.hidden {
    display: none;
}

/* 地图 Canvas：完全填充层 */
#map-canvas {
    position: absolute;
    inset: 0;
    display: block;
}

/* 游戏层 */
#game-layer {
    z-index: 200;
    background: #1a1a2e;
}

#game-layer.hidden {
    display: none;
}

/* 游戏 Canvas：只占据中间游戏区域，不包括 UI header/footer */
#gameCanvas {
    position: absolute;
    top: 15vh;     /* ✅ 从顶部留出 UI header 的空间 */
    left: 0;
    width: 100%;
    height: 75vh;  /* ✅ 中间游戏区域高度 */
    display: block;
}

/* 故事层 */
#story-layer {
    z-index: 300;
    background: radial-gradient(circle, #1e3c72 0%, #0a0a0a 100%);
    display: flex;
    justify-content: center;
    align-items: center;
}

#story-layer.hidden {
    display: none;
}

/* 故事 Canvas：完全填充层 */
#story-canvas {
    position: absolute;
    inset: 0;
    display: block;
}

/* 模态框层：最高层级 */
#modal-layer {
    z-index: 9000;
    pointer-events: none;  /* 默认不拦截点击，只有显示 modal 时才启用 */
}

#modal-layer.active {
    pointer-events: auto;
}

/* UI 层：叠加在游戏 Canvas 之上 */
#ui-layer {
    z-index: 500;
    pointer-events: none;  /* UI 层本身不拦截点击 */
}

/* UI 层内的交互元素需要显式启用 pointer-events */
#ui-layer > * {
    pointer-events: auto;
}

/* 迷雾视觉层必须完全点击穿透 */
#fog-layer,
#fog-canvas,
.fog-layer,
.fog-overlay,
[data-fog-overlay] {
    pointer-events: none !important;
}

/* ============================================================
   响应式适配
   ============================================================ */

/* 移动设备：隐藏滚动条 */
@media (max-width: 768px) {
    #stage {
        /* iOS Safari 地址栏兼容 */
        height: 100vh;
        height: 100dvh;  /* 动态视口高度（如果支持） */
    }
}

/* 横屏模式 */
@media (orientation: landscape) and (max-height: 500px) {
    /* 横屏时可能需要调整 UI 密度 */
}

/* 高 DPR 设备优化 */
@media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    /* Canvas 会由 ViewportManager 自动处理 DPR */
}
